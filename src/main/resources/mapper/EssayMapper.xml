<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.superb.mapper.EssayMapper">

    <resultMap id="essay" type="com.superb.dto.EssayDto">
        <id column="essay_id" property="essayId"/>
        <result column="essay_title" property="essayTitle"/>
        <result column="essay_text" property="essayText"/>
        <result column="user_id" property="userId"/>
        <!--连接标签表 显示动态的标签-->
        <association property="label" column="essay_label"
                     select="com.superb.mapper.LabelMapper.selectById"
                     javaType="com.superb.entity.Label"/>

        <!--连接用户表 显示发动态的用户-->
        <association column="user_id" property="user"
                     select="com.superb.mapper.UserMapper.superbById"
                     javaType="com.superb.entity.User"/>

        <!--连接转发表 显示动态的转发数量-->
        <association column="essay_id" property="forwardCount"
                     select="com.superb.mapper.ForwardMapper.forwardCountByEssayId"
                     javaType="java.lang.Integer"/>

        <!--连接点赞表 显示动态的点赞数-->
        <association column="essay_id" property="agreeCount"
                     select="com.superb.mapper.AgreeMapper.agreeCountByEssayId"
                     javaType="java.lang.Integer"/>

        <!--连接评论表 显示动态的评论数-->
        <association column="essay_id" property="commentCount"
                     select="com.superb.mapper.CommentMapper.commentCountByEssayId"
                     javaType="java.lang.Integer"/>

        <!--连接转发表 显示动态的所有转发-->
        <collection column="essay_id" property="forward"
                    select="com.superb.mapper.ForwardMapper.superbForwardById"
                    javaType="java.util.List"
                    ofType="com.superb.entity.Forward"/>

        <!--连接点赞表 显示动态的所有点赞-->
        <collection column="essay_id" property="agree"
                    select="com.superb.mapper.AgreeMapper.superbAgreeById"
                    javaType="java.util.List"
                    ofType="com.superb.entity.Agree"/>

        <!--连接评论表 显示动态的所有评论-->
        <collection column="essay_id" property="comment"
                    select="com.superb.mapper.CommentMapper.superbCommentById"
                    javaType="java.util.List"
                    ofType="com.superb.entity.Comment"/>
    </resultMap>

    <!--显示一条动态详情-->
    <select id="superbByEssayId" resultMap="essay" parameterType="java.lang.Long">
        select * from essay where essay_id = #{essayId} and deleted = 0
    </select>



    <resultMap id="essayMap" type="java.util.Map">
        <id column="essay_id" property="essayId"/>
        <result column="user_id" property="userId"/>
        <result column="essay_title" property="essayTitle"/>
        <result column="essay_text" property="essayText"/>
        <result column="create_time" property="createTime"/>
        <!--连接标签表 显示动态的标签-->
        <association property="label" column="essay_label"
                     select="com.superb.mapper.LabelMapper.selectById"
                     javaType="com.superb.entity.Label"/>

        <!--连接转发表 显示动态的转发数量-->
        <association column="essay_id" property="forwardCount"
                     select="com.superb.mapper.ForwardMapper.forwardCountByEssayId"
                     javaType="java.lang.Integer"/>

        <!--连接点赞表 显示动态的所有点赞-->
        <association column="essay_id" property="agreeCount"
                    select="com.superb.mapper.AgreeMapper.agreeCountByEssayId"
                    javaType="java.lang.Integer"/>

        <!--连接评论表 显示动态的所有评论-->
        <association column="essay_id" property="commentCount"
                    select="com.superb.mapper.CommentMapper.commentCountByEssayId"
                    javaType="java.lang.Integer"/>
    </resultMap>
    <!--查询一个用户的所有动态 包含转发数点赞数评论数-->
    <select id="superbEssayById" resultMap="essayMap" parameterType="java.lang.Long">
        select * from essay where user_id = #{userId} and deleted = 0 order by create_time desc
    </select>

    <!--查询所有动态 包含转发数点赞数评论数-->
    <select id="superbEssay" resultMap="essayMap" parameterType="java.lang.Long">
        select * from essay where deleted = 0 order by create_time desc
    </select>

    <!--显示一条动态 包含转发数点赞数评论数-->
    <select id="selectByEssayId" resultMap="essayMap" parameterType="java.lang.Long">
        select * from essay where essay_id = #{essayId} and deleted = 0
    </select>





    <!--    管理员-->


    <resultMap id="essayAdmin" type="com.superb.dto.EssayDto">
        <id column="essay_id" property="essayId"/>
        <result column="essay_title" property="essayTitle"/>
        <result column="essay_text" property="essayText"/>
        <result column="create_time" property="createTime"/>
        <!--连表-->
        <!--默认不连接已删除的数据-->
        <association column="essay_label" property="label" javaType="com.superb.entity.Label"
                     select="com.superb.mapper.LabelMapper.selectById"/>
        <association column="user_id" property="user" javaType="com.superb.entity.User"
                     select="com.superb.mapper.UserMapper.selectById"/>
    </resultMap>


    <select id="adminListDeleted" resultMap="essayAdmin">
        select * from essay
    </select>

    <select id="adminList" resultMap="essayAdmin">
        select * from essay where deleted = 0
    </select>
</mapper>
